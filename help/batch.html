<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
<title>バッチ処理機能</title>
</head>

<body>
<h1>バッチ処理機能</h1>

<h2><a name="export">コマンドラインからのエクスポート</a></h2>

<p>
hyCalendar のコマンドライン引数として
ある特定の文字列を与えると，
通常のウィンドウを開かず，そのまま
エクスポート処理だけを実行することができます．
コマンドライン引数によって操作を行うことを除けば，
実行可能な機能は<a href="file.html#export">ファイルのエクスポート</a>
と同等です．
</p>

<p>エクスポートコマンドは，以下の書式によって実現されます．
</p>
<p>
<code>-export:KEY1=VALUE1,KEY2=VALUE2,...</code>
</p>
<p>KEYおよびVALUEのペアの列として，
入出力を行うファイル名や，出力する区間，
形式などを指定することができます．</p>
<p>たとえば，schedule.cal というファイルからデータを読み込み，
現在の日から7日後まで，期間予定などを含むすべての予定データを 
カレントディレクトリの export.txt ファイルにエクスポートするには，
次のような指定を行います：
<code>-export:i=schedule.cal,o=export.txt,r=+0-+7,m=A</code>
</p>

<table border="1">
<tr><th align="left">キー名</th><th align="left">値の意味</th></tr>
<tr>
<td valign="top"><code>i</code></td>
<td>読み込むカレンダーファイル名（<code>.cal</code>）を
相対パスあるいは絶対パスで指定します．
パスに空白が入る場合は，-export オプション全体を
ダブルクォーテーションで括っておきます．
値区切りにカンマを使っている都合上，
ファイル名やパス上にカンマが入ったパスは指定できません．
</td>
</tr>

<tr>
<td valign="top"><code>o</code></td>
<td>出力先となるテキストファイル名を，
相対パスあるいは絶対パスで指定します．
パスに空白が入る場合は，-export オプション全体を
ダブルクォーテーションで括っておきます．
値区切りにカンマを使っている都合上，
ファイル名やパス上にカンマが入ったパスは指定できません．
</td>
</tr>

<tr>
<td valign="top"><code>r</code></td>
<td>
<p>エクスポートする期間を指定します．
値は2つの日付データをハイフンで接続したものを使用できます．
日付は <code>yyyy/m/d</code> という形式に加えて，
相対値 <code>+N</code> という指定が可能です．</p>
<p>
たとえば，<code>2008/1/1+10</code>は，
<code>2008/1/11</code>同じ意味となります．
また，単純に<code>+10</code>だけを記述すると，
このコマンドを実行した日から10日後を意味します．
負の相対値は，<code>~</code>を使って表現します．
たとえば，<code>2008/1/1+~10</code>は2008年1月1日から10日前を，
<code>+~10</code>は現在日から10日前を，それぞれ表現します．
</p>
<p>
エクスポートする区間は，２つの値をハイフンで繋いだものです．
単純な日付による区間指定であれば <code>2008/1/1-2008/1/7</code> のように，
当日から７日後まで，というように相対範囲であれば <code>+0-+7</code> のように指定します．
また，2008年9月1日から昨日までのデータを取り出したいのであれば
<code>2008/9/1-+~1</code> と指定します．
</p>

</td>
</tr>

<tr>
<td valign="top"><code>f</code></td>
<td>
日付の形式を指定します．
値としては，<code>txt</code>（テキスト形式），
<code>csv</code>（CSV形式），
<code>tab</code>（タブ区切りCSV）の3つが指定可能です．
いずれも，すべて小文字での指定です．
指定が省略された場合は，テキスト形式が使用されます．
</td>
</tr>

<tr>
<td valign="top"><code>d</code></td>
<td><p>
各日付の出力形式を選択します．
指定可能な形式と，その表示サンプルは，次の通りです．
</p>
<table border="1">
<tr><th align="left">値</th><th align="left">表示例</th> <th align="left">値</th><th align="left">表示例</th>
</tr>
<tr><td>ymd</td><td>2008/1/1</td>
<td>ymmdd</td><td>2008/01/01</td></tr>
<tr><td>md</td><td>1/1</td>
<td>mmdd</td><td>01/01</td></tr>
<tr><td>jymd</td><td>2008年1月1日</td>
<td>jymmdd</td><td>2008年01月01日</td></tr>
<tr><td>jmd</td><td>1月1日</td>
<td>jmmdd</td><td>01月01日</td></tr>
<tr><td>jgmd</td><td>平成20年1月1日</td>
<td>jgmmdd</td><td>平成20年01月01日</td></tr>
</table>
<p>指定が省略された場合は，<code>ymd</code> 形式が使用されます．</p>
</td>
</tr>

<tr>
<td valign="top"><code>m</code></td>
<td>
<p>
出力する情報に関するオプションを指定します．
以下に示すオプションが選択可能で，
有効にしたいもののアルファベットを順不同で列挙します．
</p>
<p>たとえば，曜日を出力し，期間予定，周期予定，TODO項目を出力したいなら，
<code>m=NA</code>あるいは<code>m=AN</code>という指定を行ってください．
オプション指定のアルファベットは，常に大文字です．
</p>

<dl>
<dt>N: [曜日を出力する]</dt>
<dd>このオプションを指定すると，
エクスポートした各日付の後ろに曜日が付与されるようになります．
</dd>

<dt>A: [期間・周期予定，TODO項目を含める]</dt>
<dd>このオプションを指定すると，
期間予定，周期予定，
日付名として設定されている周期予定，
日付を含んだTODO項目をエクスポートするようになります．
</dd>

<dt>R: [参照ファイルの内容も含める]</dt>
<dd>このオプションを指定すると，
参照ファイルのデータも同時に出力することができます．</dd>

<dt>E: [予定のない日も日付だけ出力する]</dt>
<dd>通常，日付メモなどの予定が一切存在しない場合，
その日付を飛ばして出力します．
このオプションを指定すると，
日付だけ（存在するなら祝日名も含めて）の空の項目を出力します．
</dd>

<dt>C: [各日付データの先頭行だけに日付を付加する (CSV用)]</dt>
<dd>この項目は，CSV形式あるいはタブ区切りCSV形式を選択した場合にのみ有効です．
通常，各行に，"日付[区切り文字]日付メモの内容" という形式で
出力されますが，この設定を有効にすると，
日付の出力をできるだけ省略します．
</dd>
</dl>

<p>指定が省略された場合は，すべてのオプションが
指定されていないものとして扱います．
</p>
</td>
</tr>

</table>

<h3>エラー処理</h3>
<p>
エクスポートは，他のアプリケーションから呼び出されることを想定しており，
標準入出力によるインタラクションは行いません．
ファイルの読み込みに失敗したときや，認識できないオプションが存在したとき，
エラーメッセージは出力ファイル中に書き出されます．
このとき，出力ファイルの１行目の先頭は，必ず "ERROR" という文字列で始まります．
</p>
<p>
出力ファイルオプションが指定されていないとき，
出力ファイルが作成できなかったときは，
警告等の表示もなく，hyCalendar の実行は終了します．
</p>

</body>
</html>

